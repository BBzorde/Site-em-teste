<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promoções - F5 Games</title>
    <!-- Favicon personalizado -->
    <link rel="icon" type="image/webp" href="https://i.ibb.co/Q7QTMNrt/key-f5-symbol-black-computer-260nw-1968799435.webp">
    <!-- Incluindo Tailwind CSS via CDN para estilo rápido e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Inter para uma tipografia moderna e limpa -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Fundo escuro para tema gamer */
            color: #e2e8f0; /* Cor do texto clara */
        }
        .container {
            max-width: 1200px;
        }
        /* Estilo para preço original riscado */
        .original-price {
            text-decoration: line-through;
            color: #9ca3af; /* text-gray-400 */
            font-size: 0.9em;
            margin-right: 0.5rem;
        }
        /* Estilo para preço final */
        .final-price {
            color: #34d399; /* text-green-400 */
            font-weight: bold;
        }
        /* Estilo para a visualização em lista */
        .list-view .promotion-card {
            flex-direction: row;
            align-items: center;
            text-align: left;
            padding: 1rem;
        }
        .list-view .promotion-card img {
            width: 120px; /* Largura fixa para a imagem na lista */
            height: 67px; /* Altura proporcional para 16:9 */
            object-fit: cover;
            margin-right: 1rem;
            border-radius: 0.25rem;
        }
        .list-view .promotion-card .content {
            flex-grow: 1;
        }
        .list-view .promotion-card .title {
            font-size: 1.125rem; /* text-lg */
            margin-bottom: 0.25rem;
        }
        .list-view .promotion-card .prices {
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            margin-top: 0.5rem;
        }
        .list-view .promotion-card .discount-badge {
            margin-left: 0.75rem;
        }
        /* Botão de Voltar ao Topo */
        #backToTopBtn {
            display: none; /* Hidden by default */
            position: fixed; /* Fixed/sticky position */
            bottom: 20px; /* Place the button at the bottom of the page */
            right: 30px; /* Place the button 30px from the right */
            z-index: 99; /* Make sure it does not overlap */
            border: none; /* Remove borders */
            outline: none; /* Remove outline */
            background-color: #4a5568; /* Dark gray background */
            color: white; /* Text color */
            cursor: pointer; /* Add a mouse pointer on hover */
            padding: 15px; /* Some padding */
            border-radius: 10px; /* Rounded corners */
            font-size: 18px; /* Increase font size */
            transition: background-color 0.3s ease;
        }

        #backToTopBtn:hover {
            background-color: #2d3748; /* Darker background on hover */
        }
    </style>
</head>
<body class="antialiased">
    <!-- Cabeçalho do Site -->
    <header class="bg-gray-900 py-4 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between px-4">
            <!-- Logo/Nome do Site -->
            <a href="index.html" class="mb-4 md:mb-0">
                <img src="https://i.ibb.co/Q7QTMNrt/key-f5-symbol-black-computer-260nw-1968799435.webp" alt="" class="h-12 w-auto rounded-md">
            </a>
            <!-- Menu de Navegação -->
            <nav>
                <ul class="flex flex-wrap justify-center space-x-6">
                    <li><a href="index.html" class="text-gray-300 hover:text-blue-400 text-lg font-semibold transition duration-300">Início</a></li>
                    <li><a href="noticias.html" class="text-gray-300 hover:text-blue-400 text-lg font-semibold transition duration-300">Notícias</a></li>
                    <li><a href="analises.html" class="text-gray-300 hover:text-blue-400 text-lg font-semibold transition duration-300">Análises</a></li>
                    <!-- Link "Promoções" ativo -->
                    <li><a href="promocoes.html" class="text-blue-400 text-lg font-semibold transition duration-300">Promoções</a></li>
                    <li><a href="contato.html" class="text-gray-300 hover:text-blue-400 text-lg font-semibold transition duration-300">Contato</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Conteúdo da Página de Promoções -->
    <main class="container mx-auto px-4 py-12 min-h-screen">
        <section>
            <h1 class="text-4xl font-bold text-white mb-8 text-center">Promoções Imperdíveis!</h1>
            <p class="text-gray-300 text-lg mb-10 text-center">
                Fique por dentro das melhores ofertas e descontos do mundo dos games! Atualizamos esta página regularmente com as promoções mais quentes diretamente da SteamDB.
            </p>

            <!-- Controles de Filtro e Visualização -->
            <div class="flex flex-col md:flex-row justify-between items-center bg-gray-800 p-4 rounded-lg shadow-md mb-8">
                <!-- Botões de Alternar Visualização -->
                <div class="flex space-x-2 mb-4 md:mb-0">
                    <button id="columnViewBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                        Colunas
                    </button>
                    <button id="listViewBtn" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                        Lista
                    </button>
                </div>

                <!-- Controles de Ordenação e Busca -->
                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 w-full md:w-auto">
                    <div class="relative w-full md:w-auto">
                        <label for="sortOrder" class="sr-only">Ordenar por:</label>
                        <select id="sortOrder" class="block appearance-none w-full bg-gray-700 border border-gray-600 text-white py-2 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-gray-600 focus:border-blue-500">
                            <option value="name-asc">Nome (A-Z)</option>
                            <option value="name-desc">Nome (Z-A)</option>
                            <option value="discount-desc">Maior Desconto</option>
                            <option value="price-asc">Menor Preço</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                        </div>
                    </div>
                    <div class="relative flex w-full md:w-auto">
                        <label for="search" class="sr-only">Buscar jogo...</label>
                        <input type="text" id="search" placeholder="Buscar jogo..." class="flex-grow bg-gray-700 border border-gray-600 text-white py-2 px-4 rounded-l-lg focus:outline-none focus:bg-gray-600 focus:border-blue-500">
                        <button id="searchBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r-lg transition duration-300">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </button>
                    </div>
                    <button id="clearFilterBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 w-full md:w-auto">Limpar Filtro</button>
                </div>
            </div>

            <!-- Mensagens de Status -->
            <p id="loadingMessage" class="text-center text-blue-400 text-lg mb-4">Carregando promoções...</p>
            <p id="errorMessage" class="text-center text-red-500 text-lg mb-4 hidden">Erro ao carregar promoções. Por favor, verifique a URL da função Cloud Functions ou sua configuração (CORS).</p>

            <!-- Lista de Promoções -->
            <div id="promotionsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- As promoções serão carregadas aqui pelo JavaScript -->
            </div>

            <!-- Controles de Paginação -->
            <div id="paginationControls" class="flex justify-center items-center space-x-4 mt-8 hidden">
                <button id="prevPageBtn" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Anterior</button>
                <span id="pageInfo" class="text-lg text-gray-300">Página 1 de 1</span>
                <button id="nextPageBtn" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Próxima</button>
                <div class="relative">
                    <label for="itemsPerPage" class="sr-only">Itens por página:</label>
                    <select id="itemsPerPage" class="block appearance-none w-full bg-gray-700 border border-gray-600 text-white py-2 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-gray-600 focus:border-blue-500">
                        <option value="10">Itens por página: 10</option>
                        <option value="20">Itens por página: 20</option>
                        <option value="50">Itens por página: 50</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Botão de Voltar ao Topo -->
    <button id="backToTopBtn" title="Voltar ao Topo">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
    </button>

    <!-- Rodapé do Site -->
    <footer class="bg-gray-900 py-8 mt-12">
        <div class="container mx-auto px-4 text-center text-gray-400">
            <p>&copy; 2025 F5 Games. Todos os direitos reservados.</p>
            <div class="mt-4 flex justify-center space-x-6">
                <a href="#" class="hover:text-blue-400 transition duration-300">Política de Privacidade</a>
                <span class="text-gray-600">|</span>
                <a href="#" class="hover:text-blue-400 transition duration-300">Termos de Uso</a>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const promotionsList = document.getElementById('promotionsList');
            const loadingMessage = document.getElementById('loadingMessage');
            const errorMessage = document.getElementById('errorMessage');
            const columnViewBtn = document.getElementById('columnViewBtn');
            const listViewBtn = document.getElementById('listViewBtn');
            const sortOrderSelect = document.getElementById('sortOrder');
            const searchInput = document.getElementById('search');
            const searchBtn = document.getElementById('searchBtn');
            const clearFilterBtn = document.getElementById('clearFilterBtn');
            const prevPageBtn = document.getElementById('prevPageBtn');
            const nextPageBtn = document.getElementById('nextPageBtn');
            const pageInfoSpan = document.getElementById('pageInfo');
            const itemsPerPageSelect = document.getElementById('itemsPerPage');
            const paginationControls = document.getElementById('paginationControls');
            const backToTopBtn = document.getElementById('backToTopBtn');

            let allPromotions = []; // Armazena todas as promoções
            let filteredPromotions = []; // Armazena as promoções filtradas/pesquisadas
            let currentPage = 1;
            let promotionsPerPage = parseInt(itemsPerPageSelect.value);
            let currentView = 'columns'; // 'columns' ou 'list'

            // URL da sua Cloud Function implantada
            // ***** IMPORTANTE: SUBSTITUA ESTE PLACEHOLDER PELO SEU URL REAL DA CLOUD FUNCTION *****
            const cloudFunctionUrl = 'YOUR_CLOUD_FUNCTION_URL_HERE'; 
            // Exemplo: const cloudFunctionUrl = 'https://southamerica-east1-your-project-id.cloudfunctions.net/scrape-steam-promotions-function';

            // Função para exibir as promoções na UI
            function displayPromotions(page) {
                promotionsList.innerHTML = ''; // Limpa a lista atual
                currentPage = page;

                const startIndex = (currentPage - 1) * promotionsPerPage;
                const endIndex = startIndex + promotionsPerPage;
                const promotionsToDisplay = filteredPromotions.slice(startIndex, endIndex);

                if (promotionsToDisplay.length === 0) {
                    promotionsList.innerHTML = '<p class="col-span-full text-center text-gray-400">Nenhuma promoção encontrada com os critérios atuais.</p>';
                    paginationControls.classList.add('hidden');
                    return;
                }

                promotionsToDisplay.forEach(promo => {
                    const promotionCard = document.createElement('article');
                    promotionCard.className = `promotion-card bg-gray-800 rounded-lg shadow-lg overflow-hidden transition duration-300 hover:shadow-2xl ${currentView === 'columns' ? 'flex flex-col' : 'flex flex-row items-center'}`;

                    // Placeholder para imagem se a URL for inválida ou não encontrada
                    const imageUrl = promo.image_src && promo.image_src !== "URL da imagem não encontrada"
                        ? promo.image_src
                        : 'https://placehold.co/600x338/60A5FA/fff?text=IMAGEM+NÃO+DISPONÍVEL';

                    promotionCard.innerHTML = `
                        <img src="${imageUrl}" alt="${promo.image_alt}" class="w-full ${currentView === 'columns' ? 'h-48' : 'h-24 w-44'} object-cover">
                        <div class="p-4 flex flex-col ${currentView === 'columns' ? 'items-start' : 'items-start'} content">
                            <h4 class="text-xl font-semibold mb-2 text-white title">
                                <a href="${promo.link}" target="_blank" rel="noopener noreferrer" class="hover:text-blue-400 transition duration-300">${promo.title}</a>
                            </h4>
                            <div class="flex items-center mb-2 prices">
                                ${promo.original_price && promo.original_price !== 'N/A' ? `<span class="original-price">${promo.original_price}</span>` : ''}
                                <span class="final-price">${promo.final_price}</span>
                                ${promo.discount_percent && promo.discount_percent !== 'N/A' && promo.discount_percent !== '0%' ? `<span class="bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full ml-2 discount-badge">${promo.discount_percent}</span>` : ''}
                            </div>
                            <a href="${promo.link}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline font-medium self-start">Ver Promoção &rarr;</a>
                        </div>
                    `;
                    promotionsList.appendChild(promotionCard);
                });

                updatePaginationControls();
                toggleView(currentView); // Garante que a visualização correta seja aplicada
            }

            // Função para atualizar os controles de paginação
            function updatePaginationControls() {
                const totalPages = Math.ceil(filteredPromotions.length / promotionsPerPage);
                pageInfoSpan.textContent = `Página ${currentPage} de ${totalPages}`;

                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;

                if (filteredPromotions.length > promotionsPerPage) {
                    paginationControls.classList.remove('hidden');
                } else {
                    paginationControls.classList.add('hidden');
                }
            }

            // Função para alternar a visualização (colunas/lista)
            function toggleView(view) {
                currentView = view;
                if (view === 'columns') {
                    promotionsList.classList.remove('grid-cols-1', 'list-view');
                    promotionsList.classList.add('grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3');
                    columnViewBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    columnViewBtn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                    listViewBtn.classList.add('bg-gray-700', 'hover:bg-gray-600');
                    listViewBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                } else { // list
                    promotionsList.classList.remove('md:grid-cols-2', 'lg:grid-cols-3');
                    promotionsList.classList.add('grid-cols-1', 'list-view');
                    listViewBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    listViewBtn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                    columnViewBtn.classList.add('bg-gray-700', 'hover:bg-gray-600');
                    columnViewBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                }
                displayPromotions(currentPage); // Redesenha para aplicar os estilos
            }

            // Função para ordenar as promoções
            function sortPromotions() {
                const sortBy = sortOrderSelect.value;
                filteredPromotions.sort((a, b) => {
                    if (sortBy === 'name-asc') {
                        return a.title.localeCompare(b.title);
                    } else if (sortBy === 'name-desc') {
                        return b.title.localeCompare(a.title);
                    } else if (sortBy === 'discount-desc') {
                        // Converte a porcentagem para número para ordenar
                        const discountA = parseFloat(a.discount_percent.replace('%', '').replace('-', '')) || 0;
                        const discountB = parseFloat(b.discount_percent.replace('%', '').replace('-', '')) || 0;
                        return discountB - discountA;
                    } else if (sortBy === 'price-asc') {
                        // Converte o preço final para número para ordenar
                        const priceA = parseFloat(a.final_price.replace('R$', '').replace('.', '').replace(',', '.')) || Infinity;
                        const priceB = parseFloat(b.final_price.replace('R$', '').replace('.', '').replace(',', '.')) || Infinity;
                        return priceA - priceB;
                    }
                    return 0;
                });
                displayPromotions(1); // Volta para a primeira página após ordenar
            }

            // Função para filtrar as promoções pela pesquisa
            function filterPromotions() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                if (searchTerm === '') {
                    filteredPromotions = [...allPromotions];
                } else {
                    filteredPromotions = allPromotions.filter(promo =>
                        promo.title.toLowerCase().includes(searchTerm)
                    );
                }
                sortPromotions(); // Aplica a ordenação após a filtragem
            }

            // Event Listeners
            sortOrderSelect.addEventListener('change', sortPromotions);
            searchBtn.addEventListener('click', filterPromotions);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    filterPromotions();
                }
            });
            clearFilterBtn.addEventListener('click', () => {
                searchInput.value = '';
                filterPromotions();
            });

            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    displayPromotions(currentPage - 1);
                }
            });

            nextPageBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(filteredPromotions.length / promotionsPerPage);
                if (currentPage < totalPages) {
                    displayPromotions(currentPage + 1);
                }
            });

            itemsPerPageSelect.addEventListener('change', () => {
                promotionsPerPage = parseInt(itemsPerPageSelect.value);
                displayPromotions(1); // Volta para a primeira página com a nova quantidade de itens
            });

            // Carregar promoções da Cloud Function
            fetch(cloudFunctionUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    loadingMessage.classList.add('hidden'); // Oculta a mensagem de carregamento
                    if (data && data.promotions && data.promotions.length > 0) {
                        allPromotions = data.promotions;
                        filteredPromotions = [...allPromotions];
                        displayPromotions(1);
                        toggleView('columns');
                    } else {
                        promotionsList.innerHTML = '<p class="col-span-full text-center text-gray-400">Nenhuma promoção encontrada na URL da função Cloud Functions ou o resultado está vazio/inválido.</p>';
                        paginationControls.classList.add('hidden');
                    }
                })
                .catch(error => {
                    loadingMessage.classList.add('hidden');
                    errorMessage.classList.remove('hidden'); // Exibe a mensagem de erro
                    console.error('Erro ao carregar ou processar o JSON de promoções:', error);
                });

            columnViewBtn.addEventListener('click', () => toggleView('columns'));
            listViewBtn.addEventListener('click', () => toggleView('list'));

            window.addEventListener('scroll', () => {
                if (window.scrollY > 200) {
                    backToTopBtn.style.display = 'block';
                } else {
                    backToTopBtn.style.display = 'none';
                }
            });

            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
